<!DOCTYPE HTML>
<!--
	Big Picture by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

<head>
	<title>Speaker Recognition</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<link rel="stylesheet" href="../static/htmls/assets/css/main.css" />
	<noscript>
		<link rel="stylesheet" href="../static/htmls/assets/css/noscript.css" /></noscript>
	<script src="https://cdn.rawgit.com/mattdiamond/Recorderjs/08e7abd9/dist/recorder.js"></script>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>

<body class="is-preload">
	{% if name %}
	<audio id='playwav' controls autoplay>
		<source src="../static/wav_file/{{name}}.wav" type="audio/wav">
	</audio>
	{% endif %}
	<!-- Header -->
	<header id="header" style="min-width: 840px;">
		<h1>AIEN07 第三組</h1>
		<nav>
			<ul>
				<li><a href="#intro" id='recognize'>Introduction</a></li>
				<li><a href="#one">Kunyu</a></li>
				<li><a href="#two">Joyee</a></li>
				<li><a href="#three">Rick</a></li>
				<li><a href="#four">Hsiaoen</a></li>
				<li><a href="#five">Ryan</a></li>
				<li><a href="#six">Yanbo</a></li>
				<li><a href="#work">Our Life</a></li>
				<li><a href="#uploadwav">Upload wav</a></li>
			</ul>
		</nav>
	</header>

	<!-- Intro -->
	<section id="intro" class="main style1 dark fullscreen">
		<div class="content">
			<header style="padding-top: 12%;">
				{% if filename %}
                                <audio id='playfile' controls>
                                        <source src="../static/wav_file/{{filename}}" type="audio/wav">
                                </audio>
                                {% endif %}
				<button id='btn'
					style="background-image: url('../static/htmls/images/mic2.png');width: 205px;height: 205px;border-radius: 50%;"></button>
				<!-- <img src="images/mic.png" alt="" style="width: 20%; border: 5px; border-style: solid; border-radius: 50%; border-color: black;"> -->
				<form action="/" method="POST">
					<!-- <input type="textbox" name='username'> -->
					<input type="submit" value="Submit" id='predict' disabled>
				</form>
				{% if name %}
				<a href="#{{name}}" id='go'><img src="../static/htmls/images/members/{{name}}_after.jpg" style="width: 205px;border-radius: 50%;"></a>
				{% endif %}
			</header>
			{% if condition == 'error' %}
			<strong id="msg" style="background-color: black; color: white;">&emsp;Invalid file format! Please upload wav file! &emsp;</strong>
			{% elif name != '' %}
			<strong id="msg" style="background-color: black; color: white;">&emsp;Welcome back {{real_name}}&emsp;</strong>
			{% else %}
			<strong id="msg" style="background-color: black; color: white;">&emsp;Press the button upside to recognize who you
				are with your voice.&emsp;</strong>
			{% endif %}
			<!-- <footer> -->
			<br>
			<a href="#one" class="button style2 down" style="color:red;">More</a>
			<!-- </footer> -->
		</div>
	</section>

	<!-- One -->
	<section id="one" class="main style2 left dark fullscreen">
		<div class="content box style2">
			<header>
				<h2>楊坤育&emsp;Kunyu-Yang</h2>
			</header>
			<img src="../static/htmls/images/members/kunyu_1.jpg" alt="" style="width: 45%">
			<div style="float: right; width: 45%; font-weight:bold;">
				工作內容：<br>
				<ol style="list-style-type:decimal;">
					<li>資料蒐集</li>
					<li>資料前處裡</li>
					<li>降噪模型訓練</li>
					<li>前端網頁架設</li>
				</ol>
			</div>
		</div>
		<a href="#two" class="button style2 down anchored">Next</a>
	</section>

	<!-- Two -->
	<section id="two" class="main style2 right dark fullscreen">
		<div class="content box style2">
			<header>
				<h2>陳梅英&emsp;Joyee-Tan</h2>
			</header>
			<img src="../static/htmls/images/members/joyee_1.jpg" alt="" style="width: 45%">
			<div style="float: right; width: 45%; font-weight:bold;">
				工作內容：<br>
				<ol style="list-style-type:decimal;">
					<li>資料蒐集</li>
					<li>資料前處裡</li>
					<li>聲紋辨識模型訓練</li>
					<li>降噪模型訓練</li>
					<li>架設雲端環境</li>
				</ol>
			</div>
		</div>
		<a href="#three" class="button style2 down anchored">Next</a>
	</section>
	<!-- Three -->
	<section id="three" class="main style2 left dark fullscreen">
		<div class="content box style2">
			<header>
				<h2>藍啟文&emsp;Rick-Lan</h2>
			</header>
			<img src="../static/htmls/images/members/blue_11.jpg" alt="" style="width: 45%">
			<div style="float: right; width: 45%; font-weight:bold;">
				工作內容：<br>
				<ol style="list-style-type:decimal;">
					<li>資料蒐集</li>
					<li>資料前處裡</li>
					<li>降噪模型訓練</li>
					<li>前後端整合上雲</li>
				</ol>
			</div>
		</div>
		<a href="#four" class="button style2 down anchored">Next</a>
	</section>
	<!-- Four -->
	<section id="four" class="main style2 right dark fullscreen">
		<div class="content box style2">
			<header>
				<h2>郭孝恩&emsp;Hsiaoen-Guo</h2>
			</header>
			<img src="../static/htmls/images/members/hsiaoen_1.jpg" alt="" style="width: 45%">
			<div style="float: right; width: 45%; font-weight:bold;">
				工作內容：<br>
				<ol style="list-style-type:decimal;">
					<li>資料蒐集</li>
					<li>降噪模型訓練</li>
					<li>前端網頁架設</li>
				</ol>
			</div>
		</div>
		<a href="#five" class="button style2 down anchored">Next</a>
	</section>
	<!-- Five -->
	<section id="five" class="main style2 left dark fullscreen">
		<div class="content box style2">
			<header>
				<h2>張曜軒&emsp;Ryan-Chang</h2>
			</header>
			<img src="../static/htmls/images/members/ryan_1.jpg" alt="" style="width: 45%">
			<div style="float: right; width: 45%; font-weight:bold;">
				工作內容：<br>
				<ol style="list-style-type:decimal;">
					<li>資料蒐集</li>
                                        <li>資料前處理</li>
					<li>降噪模型訓練</li>
					<li>前端網頁架設</li>
				</ol>
			</div>
		</div>
		<a href="#six" class="button style2 down anchored">Next</a>
	</section>

	<!-- Six -->
	<section id="six" class="main style2 right dark fullscreen">
		<div class="content box style2">
			<header>
				<h2>趙研博&emsp;Yanbo-Chao</h2>
			</header>
			<img src="../static/htmls/images/members/yanbo_1.jpg" alt="" style="width: 45%">
			<div style="float: right; width: 45%; font-weight:bold;">
				工作內容：<br>
				<ol style="list-style-type:decimal;">
					<li>資料蒐集</li>
					<li>降噪模型訓練</li>
					<li>前端網頁架設</li>
				</ol>
			</div>
		</div>
		<a href="#work" class="button style2 down anchored">Next</a>
	</section>
	<!-- Work -->
	<section id="work" class="main style3 primary">
		<div class="content">
			<header>
				<h2>Our Life</h2>
				<p>You know some birds are not meant to be caged, their feathers are just too bright.<br>
					你知道，有些鳥兒是註定不會被關在牢籠裡的，它們的每一片羽毛都閃耀著自由的光輝。<br>
					《Shawshank Redemption肖申克的救贖》</p>
			</header>

			<!-- Gallery  -->
			<div class="gallery">
				<article class="from-left">
					<a href="../static/htmls/images/fulls/joyee_2.jpg" class="image fit"><img
							src="../static/htmls/images/thumbs/joyee_2.jpg" title="King-Kong is me!!!!" alt="" /></a>
				</article>
				<article class="from-right">
					<a href="../static/htmls/images/fulls/kunyu_2.jpg" class="image fit"><img
							src="../static/htmls/images/thumbs/kunyu_2.jpg"
							title="If you're afraid to fail, then you're probably going to fail." alt="" /></a>
				</article>
				<article class="from-left">
					<a href="../static/htmls/images/fulls/blue_2.jpg" class="image fit"><img
							src="../static/htmls/images/thumbs/blue_2.jpg" title="Nothing is more important than your family!" alt="" /></a>
				</article>
				<article class="from-right">
					<a href="../static/htmls/images/fulls/hsiaoen_2.jpg" class="image fit"><img
							src="../static/htmls/images/thumbs/hsiaoen_2.jpg" title="All good!" alt="" /></a>
				</article>
				<article class="from-left">
					<a href="../static/htmls/images/fulls/ryan_2.jpg" class="image fit"><img
							src="../static/htmls/images/thumbs/ryan_2.jpg" title="I love my girl forever~" alt="" /></a>
				</article>
				<article class="from-right">
					<a href="../static/htmls/images/fulls/yanbo_2.jpg" class="image fit"><img
							src="../static/htmls/images/thumbs/yanbo_2.jpg" title="BoBoBo" alt="" /></a>
				</article>
			</div>

		</div>
	</section>

	<!-- Contact -->
	<!-- upload wav -->
	<section id="uploadwav" class="main style1 dark fullscreen">
		<div class="content">
			<form action="/upload" method="post" enctype=multipart/form-data>
					<label style="background-image: url('../static/htmls/images/wav1.png');width: 205px; height: 205px;border-radius: 50%;margin-left: 39%;">
						<input type="file" name="file" style="display: none;">
					</label>
				<header>
					<button id="uploadfile"  style="font-size: unset">Submit</button>
					<!-- <img src="../static/htmls/images/wav.png" alt="" style="width: 23%;"> -->
				</header>
				<strong style="background-color: black; color: white;">&emsp;Press the button upside to recognize who you
					are with your voice.&emsp;</strong>
			</form>
		</div>
	</section>

	<!-- Footer -->
	<footer id="footer">

		<!-- Icons -->
		<ul class="icons">
			<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
			<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
			<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
			<li><a href="#" class="icon brands fa-linkedin-in"><span class="label">LinkedIn</span></a></li>
			<li><a href="#" class="icon brands fa-dribbble"><span class="label">Dribbble</span></a></li>
			<li><a href="#" class="icon brands fa-pinterest"><span class="label">Pinterest</span></a></li>
		</ul>

		<!-- Menu -->
		<ul class="menu">
			<li>&copy; Untitled</li>
			<li>Design: <a href="https://html5up.net">HTML5 UP</a></li>
		</ul>

	</footer>

	<!-- Scripts -->
	<script src="../static/htmls/assets/js/jquery.min.js"></script>
	<script src="../static/htmls/assets/js/jquery.poptrox.min.js"></script>
	<script src="../static/htmls/assets/js/jquery.scrolly.min.js"></script>
	<script src="../static/htmls/assets/js/jquery.scrollex.min.js"></script>
	<script src="../static/htmls/assets/js/browser.min.js"></script>
	<script src="../static/htmls/assets/js/breakpoints.min.js"></script>
	<script src="../static/htmls/assets/js/util.js"></script>
	<script src="../static/htmls/assets/js/main.js"></script>

</body>
<script>
	$(function () {

		$('#playwav').hide();

		{% if not name %}
		$('#go').hide();
		{% else %}
		$('#btn').hide();
		$('#predict').hide();
		$('#go').show();
		{% endif %}

		// $(window).scroll(function () {
		// 	var scrollVal = $(this).scrollTop();
		// 	// console.log(scrollVal);
		// 	if (scrollVal > 450) {
		// 		$('#go').hide();
		// 		$('#btn').show();
		// 		$('#sub').show();
		// 		predict.disabled = true;
		// 		$('#msg').text("Press the button upside to recognize who you are with your voice.")
		// 	}
		// });

		$('#recognize').on('click',function(){
			$('#go').hide();
			$('#btn').show();
			$('#predict').show();
			predict.disabled = true;
			// console.log('test')
			$('#playfile').hide();
			$('#msg').text("Press the button upside to recognize who you are with your voice.");
		})

		$('#uploadfile').on('click',function(){
			$('#playfile').show();
		})

		$('#btn').on('click', function () {
			btn.disabled = true;
			btn.style = "opacity: 0.5;background-image: url('../static/htmls/images/mic2.png');width: 205px;height: 205px;border-radius: 50%;";
			var constraints = {
				audio: {
					sampleRate: 16000,
					channelCount: 1,
					volume: 1.0
				},
				video: false
			}
			navigator.mediaDevices.getUserMedia(constraints).then(function (stream) {
				console.log("getUserMedia() success, stream created, initializing Recorder.js ...");

                /*
                    create an audio context after getUserMedia is called
                    sampleRate might change after getUserMedia is called, like it does on macOS when recording through AirPods
                    the sampleRate defaults to the one set in your OS for your playback device
        
                */
				audioContext = new AudioContext();

				//update the format 
				// document.getElementById("formats").innerHTML = "Format: 1 channel pcm @ " + 16000 / 1000 + "kHz"

				/*  assign to gumStream for later use  */
				gumStream = stream;

				/* use the stream */
				input = audioContext.createMediaStreamSource(stream);

                /* 
                    Create the Recorder object and configure to record mono sound (1 channel)
                    Recording 2 channels  will double the file size
                */
				rec = new Recorder(input, { numChannels: 1 })

				//start the recording process
				rec.record()

				console.log("Recording started");

				setTimeout(function () {
				    console.log("stopButton clicked");

				    //tell the recorder to stop the recording
				    rec.stop();

				    //stop microphone access
				    gumStream.getAudioTracks()[0].stop();

				    //create the wav blob and pass it on to createDownloadLink
				    rec.exportWAV(createDownloadLink);

				    function createDownloadLink(blob) {
				        var xhr = new XMLHttpRequest();
				         xhr.onload = function (e) {
				             if (this.readyState === 4) {
				                 console.log("Server returned: ", e.responseText);
				             }
				         };
				        var fd = new FormData();
				        fd.append("audio_data", blob);
				        xhr.open("POST", "/testrecord", true);
				        xhr.send(fd);
					}
					console.log('upload file successfully')
					btn.style = "opacity: 1;background-image: url('../static/htmls/images/mic2.png');width: 205px;height: 205px;border-radius: 50%;";
				    predict.disabled = false;
				    btn.disabled = false;
				}, 3000);

			})
		})
	})
</script>

</html>
